<!DOCTYPE html>
<html lang="en">

<head>
    <% include ../partials/head %>
        <script>
            var app_title = 'AppTitle';

            var load = null;
            var write = null;
            var del = null;

            $(document).ready(function() {
                //작성된 메모 목록을 로드합니다.
                var load = function() {
                    $.get('/load', function(data) {
                        $("#blend").empty();

                        $(data).each(function(i) {
                            var id = this._id;

                            $("#blend").prepend("<div class='item'></div>");

                            $("#blend .item:first").append("<div class='app_title'><b>" + this.app_title + "</b> (" + this.date +
                                ")&nbsp;&nbsp; | <span class='text_button del'>DELETE</span></div>");
                            $("#blend .item:first").append("<div class='contents " + id + "'>" + this.contents + "</div>");
                            $("#blend .item:first").append("<div class='app_function '>" + this.app_function1 + "</div>");
                            $("#blend .item:first").append("<div class='app_function '>" + this.app_function2 + "</div>");
                            $("#blend .item:first").append("<div class='app_function '>" + this.app_function3 + "</div>");
                            $("#blend .item:first").append("<div class='app_color '>" + this.app_color + "</div>");

                            //삭제 버튼을 눌렀을 때에 대한 이벤트 콜백함수를 지정합니다.
                            $("#blend .item:first .del").click(function(evt) {
                                del(id);
                            });
                        });
                    });
                };

                //메모 쓰기 요청을 처리하는 부분입니다.
                var write = function(contents) {
                    var app_color;
                    if ($("#app_color1").is(":checked"))
                        app_color = 'color1';
                    if ($("#app_color2").is(":checked"))
                        app_color = 'color2';
                    if ($("#app_color3").is(":checked"))
                        app_color = 'color3';

                    var postdata = {
                        'app_title': $("#app_title").val(),
                        'app_function1': $("input[name=app_function1]").is(":checked"),
                        'app_function2': $("input[name=app_function2]").is(":checked"),
                        'app_function3': $("input[name=app_function3]").is(":checked"),
                        'app_color': app_color,
                        'contents': contents
                    };

                    $.post('/write', postdata, function() {
                        load();
                    });
                };

                //메모 삭제 요청을 처리하는 부분입니다.
                var del = function(id) {
                    var postdata = {
                        '_id': id
                    };

                    $.post('/del', postdata, function() {
                        load();
                    });
                };

                //화면 상단에서 새로운 메모를 작성하고 엔터키를 쳤을 때 쓰기 요청을 발생시키기 위한 부분입니다.
                $("#write textarea").keypress(function(evt) {
                    if ((evt.keyCode || evt.which) == 13) {
                        if (this.value != "") {
                            write(this.value);

                            evt.preventDefault();

                            $(this).val("");
                        }
                    }
                });

                //쓰기 버튼을 눌렀을 때 쓰기 요청을 발생시키기 위한 부분입니다.
                $("#write_button").click(function(evt) {
                    write($("#write textarea").val());
                });

                load();
            });
        </script>
</head>

<body>
    <div id='main'>
        <div id='write'>
            <input id='app_title' class='app_title' type='text' value='AppTitle' />
            <input name="app_function1" id="app_function1" class="app_function" type="checkbox" />
            <input name="app_function2" id="app_function2" class="app_function" type="checkbox" />
            <input name="app_function3" id="app_function3" class="app_function" type="checkbox" />
            <input name="app_color" id="app_color1" class="app_color" type="radio" value="color1" checked />
            <input name="app_color" id="app_color2" class="app_color" type="radio" value="color2" />
            <input name="app_color" id="app_color3" class="app_color" type="radio" value="color3" />
            <textarea></textarea>
            <br />
            <input id='write_button' type='button' value='WRITE' />
        </div>
        <div id='blend'>
            <div class='item'>
            </div>
        </div>
    </div>
    <% include ../partials/body_script %>
</body>

</html>
